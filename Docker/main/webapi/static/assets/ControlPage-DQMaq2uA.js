import{h as O,q as A,t as L,ba as R,A as E,bb as B,D as t,F as w,aU as G,b as V,I as F,H as M,N as z,Q as H,bc as q,$ as c,a2 as k,a1 as a,b4 as C,a0 as U,b3 as Q,a3 as W,ay as _,G as y,bd as j,o as J,a as K,aG as X,b8 as s,ar as i,as as o,B as n,ad as d,a6 as I,av as Y,au as Z}from"./index-DWWWBiwt.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ee}from"./VSwitch-F0PbMuzg.js";import{V as te}from"./VTable-EPmq-nns.js";const le=z({id:String,interactive:Boolean,text:String,...H(q({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:null}),["absolute","retainFocus","captureFocus","disableInitialFocus"])},"VTooltip"),ae=O()({name:"VTooltip",props:le(),emits:{"update:modelValue":e=>!0},setup(e,r){let{slots:m}=r;const h=A(e,"modelValue"),{scopeId:T}=L(),$=R(),u=F(()=>e.id||`v-tooltip-${$}`),f=M(),l=V(()=>e.location.split(" ").length>1?e.location:e.location+" center"),g=V(()=>e.origin==="auto"||e.origin==="overlap"||e.origin.split(" ").length>1||e.location.split(" ").length>1?e.origin:e.origin+" center"),b=F(()=>e.transition!=null?e.transition:h.value?"scale-transition":"fade-transition"),N=V(()=>w({"aria-describedby":u.value},e.activatorProps));return E(()=>{const D=B.filterProps(e);return t(B,w({ref:f,class:["v-tooltip",{"v-tooltip--interactive":e.interactive},e.class],style:e.style,id:u.value},D,{modelValue:h.value,"onUpdate:modelValue":v=>h.value=v,transition:b.value,absolute:!0,location:l.value,origin:g.value,role:"tooltip",activatorProps:N.value,_disableGlobalStack:!0},T),{activator:m.activator,default:function(){var S;for(var v=arguments.length,P=new Array(v),p=0;p<v;p++)P[p]=arguments[p];return((S=m.default)==null?void 0:S.call(m,...P))??e.text}})}),G({},f)}}),oe={setup(){const e=j();return J(()=>{e.startControlPolling().catch(()=>null)}),K(()=>{e.stopControlPolling()}),e}},ne={class:"text-subtitle-1 font-weight-medium mb-3"},re={class:"text-subtitle-1 font-weight-medium mb-3 d-flex align-center ga-2"},se={class:"text-subtitle-1 font-weight-medium mb-3"},ie={class:"mono"},de={class:"mono text-truncate",style:{"max-width":"360px"}};function ue(e,r,m,h,T,$){var f;const u=X("metric-card");return c(),k(y,null,[t(C,{class:"mb-4"},{default:a(()=>[t(s,{cols:"12",md:"4"},{default:a(()=>{var l;return[t(u,{title:e.t("dashboard.metric.works"),value:((l=e.health.database)==null?void 0:l.works)??0},null,8,["title","value"])]}),_:1}),t(s,{cols:"12",md:"4"},{default:a(()=>{var l;return[t(u,{title:e.t("dashboard.metric.eh_works"),value:((l=e.health.database)==null?void 0:l.eh_works)??0},null,8,["title","value"])]}),_:1}),t(s,{cols:"12",md:"4"},{default:a(()=>{var l;return[t(u,{title:e.t("dashboard.metric.last_fetch"),value:e.formatDateMinute((l=e.health.database)==null?void 0:l.last_fetch)},null,8,["title","value"])]}),_:1})]),_:1}),(f=e.health.database)!=null&&f.error?(c(),U(Q,{key:0,type:"warning",class:"mb-4"},{default:a(()=>[i(o(e.t("dashboard.db_warning",{reason:e.health.database.error})),1)]),_:1})):W("",!0),t(_,{class:"pa-4 mb-4"},{default:a(()=>[n("div",ne,o(e.t("control.manual")),1),t(C,null,{default:a(()=>[t(s,{cols:"12",md:"4",lg:"2"},{default:a(()=>[t(d,{block:"",color:"primary",onClick:r[0]||(r[0]=l=>e.triggerTask("eh_fetch"))},{default:a(()=>[i(o(e.t("control.btn.eh_fetch")),1)]),_:1})]),_:1}),t(s,{cols:"12",md:"4",lg:"2"},{default:a(()=>[t(d,{block:"",color:"warning",variant:"tonal",onClick:e.clearEhCheckpointNow},{default:a(()=>[i(o(e.t("control.btn.clear_eh_checkpoint")),1)]),_:1},8,["onClick"])]),_:1}),t(s,{cols:"12",md:"4",lg:"2"},{default:a(()=>[t(d,{block:"",color:"primary",onClick:r[1]||(r[1]=l=>e.triggerTask("lrr_export"))},{default:a(()=>[i(o(e.t("control.btn.lrr_export")),1)]),_:1})]),_:1}),t(s,{cols:"12",md:"4",lg:"2"},{default:a(()=>[t(d,{block:"",color:"primary",onClick:r[2]||(r[2]=l=>e.triggerTask("text_ingest"))},{default:a(()=>[i(o(e.t("control.btn.text_ingest")),1)]),_:1})]),_:1}),t(s,{cols:"12",md:"4",lg:"2"},{default:a(()=>[t(d,{block:"",color:"secondary",onClick:r[3]||(r[3]=l=>e.triggerTask("eh_lrr_ingest"))},{default:a(()=>[i(o(e.t("control.btn.eh_lrr_ingest")),1)]),_:1})]),_:1}),t(s,{cols:"12",md:"4",lg:"2"},{default:a(()=>[t(d,{block:"",color:"secondary",onClick:r[4]||(r[4]=l=>e.triggerTask("eh_ingest"))},{default:a(()=>[i(o(e.t("control.btn.eh_ingest")),1)]),_:1})]),_:1}),t(s,{cols:"12",md:"4",lg:"2"},{default:a(()=>[t(d,{block:"",color:"secondary",onClick:r[5]||(r[5]=l=>e.triggerTask("lrr_ingest"))},{default:a(()=>[i(o(e.t("control.btn.lrr_ingest")),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(_,{class:"pa-4 mb-4"},{default:a(()=>[n("div",re,[n("span",null,o(e.t("control.scheduler")),1),t(ae,{location:"top"},{activator:a(({props:l})=>[t(d,w(l,{icon:"mdi-help-circle-outline",size:"x-small",variant:"text",href:"https://crontab.guru/",target:"_blank",rel:"noopener noreferrer"}),null,16)]),default:a(()=>[n("span",null,o(e.t("control.cron.help"))+" e.g. `*/30 * * * *`, `0 3 * * *`, `0 0 * * 1`",1)]),_:1})]),(c(!0),k(y,null,I(e.schedule,(l,g)=>(c(),U(C,{key:g,class:"align-center mb-2"},{default:a(()=>[t(s,{cols:"12",md:"4"},{default:a(()=>[i(o(e.schedulerLabel(g)),1)]),_:2},1024),t(s,{cols:"12",md:"3"},{default:a(()=>[t(ee,{modelValue:l.enabled,"onUpdate:modelValue":b=>l.enabled=b,color:"primary","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(s,{cols:"12",md:"5"},{default:a(()=>[t(Y,{modelValue:l.cron,"onUpdate:modelValue":b=>l.cron=b,label:`Cron (${e.schedulerLabel(g)})`,"hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)]),_:2},1024))),128)),t(d,{color:"primary",onClick:e.saveSchedule},{default:a(()=>[i(o(e.t("control.scheduler.save")),1)]),_:1},8,["onClick"])]),_:1}),t(_,{class:"pa-4"},{default:a(()=>[n("div",se,o(e.t("task.state")),1),t(te,{density:"compact"},{default:a(()=>[r[6]||(r[6]=n("thead",null,[n("tr",null,[n("th",null,"ID"),n("th",null,"Task"),n("th",null,"Status"),n("th",null,"Start"),n("th",null,"Elapsed"),n("th",null,"Log")])],-1)),n("tbody",null,[(c(!0),k(y,null,I(e.tasks,l=>(c(),k("tr",{key:l.task_id},[n("td",ie,o(e.short(l.task_id)),1),n("td",null,o(l.task),1),n("td",null,[t(Z,{size:"small",color:e.statusColor(l.status)},{default:a(()=>[i(o(e.statusText(l.status)),1)]),_:2},1032,["color"])]),n("td",null,o(e.formatDateTime(l.started_at)),1),n("td",null,o(l.elapsed_s??"-"),1),n("td",de,o(l.log_file||"-"),1)]))),128))])]),_:1})]),_:1})],64)}const be=x(oe,[["render",ue]]);export{be as default};
