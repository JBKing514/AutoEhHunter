import{$ as l,a0 as v,a1 as i,b4 as S,aC as V,D as a,b8 as g,a9 as b,ay as f,a2 as o,ad as d,G as y,B as c,as as n,a5 as z,a6 as k,a7 as I,ar as m,a3 as h,at as w,au as $,F as T,a8 as E,am as M,av as A,aw as B,ax as F}from"./index-DWWWBiwt.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as H}from"./VTextarea-COdNtP7H.js";const N={setup(){return V()},watch:{chatSessionId:{immediate:!0,handler(){typeof this.loadChatHistory=="function"&&this.loadChatHistory().catch(()=>null)}}}},j={key:0,class:"d-flex align-center justify-center fill-height"},P={class:"d-flex align-center justify-space-between mb-2"},_={class:"text-subtitle-2"},D={class:"d-flex ga-1"},R={key:0,class:"d-flex justify-end mb-2"},U={ref:"chatLogRef",class:"chat-log mb-3"},K={key:0,class:"mb-2"},x={class:"d-flex ga-1 mt-1"},G=["innerHTML"],O={class:"cover-ph"},q=["src"],J={class:"cover-title-overlay"},Q={class:"text-body-2 font-weight-medium mb-1"},W={class:"d-flex flex-wrap ga-1"},X={key:1,class:"d-flex ga-2 mt-2"},Y={class:"d-flex align-center justify-space-between mt-1"},Z={class:"text-caption text-medium-emphasis"},ee={class:"d-flex ga-1"},te={key:3,class:"text-caption text-medium-emphasis mt-1"},ae={class:"d-flex ga-2 align-center"},se={key:1,class:"d-flex ga-2 align-center mt-2"},le={class:"d-flex ga-2 mt-2"},ie={key:2,class:"text-caption text-medium-emphasis mt-2"},ne={key:3,class:"text-caption text-medium-emphasis mt-1"};function oe(e,s,de,re,ce,me){return l(),v(S,{class:"chat-shell","no-gutters":""},{default:i(()=>[a(g,{cols:"12",class:b(["pr-md-2 h-100 chat-sidebar-col",{collapsed:e.chatSidebarCollapsed}])},{default:i(()=>[a(f,{class:"pa-3 chat-sidebar",variant:"flat"},{default:i(()=>[e.chatSidebarCollapsed?(l(),o("div",j,[a(d,{size:"small",variant:"text",icon:"mdi-chevron-right",onClick:s[0]||(s[0]=u=>e.chatSidebarCollapsed=!1)})])):(l(),o(y,{key:1},[c("div",P,[c("div",_,n(e.t("chat.sessions")),1),c("div",D,[a(d,{size:"small",variant:"text",icon:"mdi-plus",onClick:e.createChatSession},null,8,["onClick"]),a(d,{size:"small",variant:"text",icon:"mdi-chevron-left",onClick:s[1]||(s[1]=u=>e.chatSidebarCollapsed=!0)})])]),a(z,{density:"compact",nav:"",class:"chat-session-list"},{default:i(()=>[(l(!0),o(y,null,k(e.chatSessions,u=>(l(),v(I,{key:u.id,title:u.title,active:e.chatSessionId===u.id,onClick:t=>e.chatSessionId=u.id},null,8,["title","active","onClick"]))),128))]),_:1})],64))]),_:1})]),_:1},8,["class"]),a(g,{cols:"12",class:b(["chat-main-col",{expanded:e.chatSidebarCollapsed}])},{default:i(()=>[a(f,{class:"pa-3 chat-main",variant:"flat"},{default:i(()=>{var u;return[e.chatSidebarCollapsed?(l(),o("div",R,[a(d,{size:"small",variant:"text","prepend-icon":"mdi-format-list-bulleted",onClick:s[2]||(s[2]=t=>e.chatSidebarCollapsed=!1)},{default:i(()=>[m(n(e.t("chat.sessions")),1)]),_:1})])):h("",!0),c("div",U,[(l(!0),o(y,null,k(((u=e.activeChatSession)==null?void 0:u.messages)||[],(t,p)=>(l(),o("div",{key:`${p}-${t.time||""}`,class:b(["chat-bubble",t.role==="assistant"?"assistant":"user"])},[e.chatEditIndex===p?(l(),o("div",K,[a(H,{modelValue:e.chatEditText,"onUpdate:modelValue":s[3]||(s[3]=r=>e.chatEditText=r),rows:"2","auto-grow":"",density:"compact"},null,8,["modelValue"]),c("div",x,[a(d,{size:"x-small",variant:"tonal",color:"primary",onClick:r=>e.saveChatEdit(p)},{default:i(()=>[m(n(e.t("chat.msg.save")),1)]),_:1},8,["onClick"]),a(d,{size:"x-small",variant:"text",onClick:e.cancelChatEdit},{default:i(()=>[m(n(e.t("chat.msg.cancel")),1)]),_:1},8,["onClick"])])])):(l(),o("div",{key:1,class:"text-body-2 chat-md",innerHTML:e.renderMarkdown(t.text)},null,8,G)),t.role==="assistant"&&t.payload&&Array.isArray(t.payload.items)&&t.payload.items.length?(l(),v(f,{key:2,class:"mt-2 pa-2",variant:"outlined"},{default:i(()=>[Array.isArray(t.payload.items)&&t.payload.items.length?(l(),v(S,{key:0,class:"mt-1"},{default:i(()=>[(l(!0),o(y,null,k(t.payload.items.slice(0,6),r=>(l(),v(g,{key:`chat-${p}-${r.id}`,cols:"6",sm:"4",md:"3"},{default:i(()=>[a(w,{"open-on-hover":"",location:"top","open-delay":700,"close-delay":120,"max-width":"360"},{activator:i(({props:C})=>[a(f,T({ref_for:!0},C,{class:"home-card compact",variant:"flat",onClick:ue=>e.openChatPayloadResult(t.payload)}),{default:i(()=>[c("div",O,[r.thumb_url?(l(),o("div",{key:0,class:"cover-bg-blur",style:E({backgroundImage:`url(${r.thumb_url})`})},null,4)):h("",!0),r.thumb_url?(l(),o("img",{key:1,src:r.thumb_url,alt:"cover",class:"cover-img",loading:"lazy"},null,8,q)):(l(),v(M,{key:2,size:"24"},{default:i(()=>[...s[11]||(s[11]=[m("mdi-image-outline",-1)])]),_:1}))]),c("div",J,n(r.title||"-"),1)]),_:2},1040,["onClick"])]),default:i(()=>[a(f,{class:"pa-2 hover-preview-card",variant:"flat"},{default:i(()=>[c("div",Q,n(r.title||"-"),1),c("div",W,[(l(!0),o(y,null,k(e.itemHoverTags(r),C=>(l(),v($,{key:`chat-tag-${C}`,size:"x-small",variant:"outlined",class:"hover-tag"},{default:i(()=>[m(n(C),1)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)):h("",!0),Array.isArray(t.payload.items)&&t.payload.items.length>6?(l(),o("div",X,[a(d,{size:"x-small",variant:"tonal",onClick:r=>e.openChatExplore(t.payload)},{default:i(()=>[m(n(e.t("chat.explore.more")),1)]),_:1},8,["onClick"])])):h("",!0)]),_:2},1024)):h("",!0),c("div",Y,[c("div",Z,n(t.role)+" Â· "+n(e.formatDateMinute(t.time)),1),c("div",ee,[a(d,{size:"x-small",icon:"mdi-content-copy",variant:"text",onClick:r=>e.copyChatMessage(t.text)},null,8,["onClick"]),a(d,{size:"x-small",icon:"mdi-pencil-outline",variant:"text",onClick:r=>e.startChatEdit(p,t.text)},null,8,["onClick"]),a(d,{size:"x-small",icon:"mdi-refresh",variant:"text",onClick:r=>e.regenerateFromMessage(p)},null,8,["onClick"]),a(d,{size:"x-small",icon:"mdi-delete-outline",variant:"text",onClick:r=>e.removeChatMessage(p)},null,8,["onClick"])])]),t.role==="assistant"&&t.stats&&Number(t.stats.tokens||0)>0?(l(),o("div",te,n(e.t("chat.stats",{tps:t.stats.tps,tokens:t.stats.tokens,sec:t.stats.elapsed_s})),1)):h("",!0)],2))),128))],512),c("div",ae,[a(d,{icon:"mdi-image-plus",variant:"text",onClick:e.triggerChatImagePick},null,8,["onClick"]),a(A,{modelValue:e.chatInput,"onUpdate:modelValue":s[4]||(s[4]=t=>e.chatInput=t),"hide-details":"",density:"comfortable",label:e.t("chat.input"),variant:"outlined",onKeyup:s[5]||(s[5]=B(t=>e.sendChat("chat"),["enter"]))},null,8,["modelValue","label"]),a(F,{modelValue:e.chatIntent,"onUpdate:modelValue":s[6]||(s[6]=t=>e.chatIntent=t),items:e.chatIntentOptions,"item-title":"title","item-value":"value",density:"comfortable","hide-details":"",style:{"max-width":"180px"}},null,8,["modelValue","items"]),a(d,{loading:e.chatSending,color:"primary",onClick:s[7]||(s[7]=t=>e.sendChat("chat"))},{default:i(()=>[m(n(e.t("chat.send")),1)]),_:1},8,["loading"])]),e.chatImageFile?(l(),o("div",se,[a($,{color:"secondary",variant:"tonal","prepend-icon":"mdi-image"},{default:i(()=>[m(n(e.chatImageFile.name),1)]),_:1}),a(d,{size:"x-small",variant:"text",icon:"mdi-close",onClick:e.clearChatImage},null,8,["onClick"])])):h("",!0),c("div",le,[a(d,{size:"small",variant:"tonal",onClick:s[8]||(s[8]=t=>e.sendChat("search_text"))},{default:i(()=>[m(n(e.t("chat.action.search_text")),1)]),_:1}),a(d,{size:"small",variant:"tonal",onClick:s[9]||(s[9]=t=>{e.tab="dashboard",e.homeTab="recommend"})},{default:i(()=>[m(n(e.t("chat.action.open_recommend")),1)]),_:1}),a(d,{size:"small",variant:"tonal",onClick:s[10]||(s[10]=t=>{e.tab="xp",e.chatInput=e.t("chat.prompt.xp"),e.sendChat("chat")})},{default:i(()=>[m(n(e.t("chat.action.explain_xp")),1)]),_:1})]),e.chatStreaming?(l(),o("div",ie,n(e.t("chat.streaming")),1)):h("",!0),e.chatStreamStats?(l(),o("div",ne,n(e.t("chat.stats",{tps:e.chatStreamStats.tps,tokens:e.chatStreamStats.tokens,sec:e.chatStreamStats.elapsed_s})),1)):h("",!0)]}),_:1})]),_:1},8,["class"])]),_:1})}const fe=L(N,[["render",oe]]);export{fe as default};
