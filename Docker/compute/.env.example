# =========================
# Compute container shared env
# =========================

# -------- Service mode --------
# Default command in compose is `agent`.
# For one-shot jobs, override command to `worker`, `eh-ingest`.
APP_HOST=0.0.0.0
APP_PORT=18080
# -------- MUST FILL START HERE --------
# -------- Database --------
POSTGRES_DSN=postgresql://postgres:change_me@pgvector-db:5432/lrr_library

# -------- LANraragi --------
LRR_BASE=http://lanraragi:3000
LRR_API_KEY=change_me
# Optional: pre-encoded value (takes priority over LRR_API_KEY)
LRR_API_KEY_B64=

# -------- OpenAI-compatible endpoints --------
# Agent skill service
LLM_API_BASE=http://llm-router:8000/v1
LLM_API_KEY=
LLM_MODEL=qwen3-next-80b-instruct

EMB_API_BASE=http://llm-router:8000/v1
EMB_API_KEY=
EMB_MODEL=bge-m3

# Vector worker service endpoints
# Dont add /v1 at the end, as compute will add it when calling
VL_BASE=http://vl-server:8002
EMB_BASE=http://emb-server:8001
OPENAI_API_KEY=
VL_MODEL_ID=vl
EMB_MODEL_ID=bge-m3
# -------- MUST FILL END HERE --------

# -------- SigLIP --------
SIGLIP_MODEL=google/siglip-so400m-patch14-384
# cpu / cuda:0
SIGLIP_DEVICE=cpu
# Optional GPU mapping inside container
SIGLIP_CUDA_VISIBLE_DEVICES=

# -------- Search / recommendation tuning --------
HOT_TAG_MIN_FREQ=5
HOT_TAG_CACHE_TTL_S=21600
TAG_FUZZY_THRESHOLD=90
SEARCH_CANDIDATES_PER_SOURCE=50
SEARCH_RRF_K=60

REC_PROFILE_DAYS=30
REC_CANDIDATE_HOURS=24
REC_CLUSTER_K=3
REC_CLUSTER_CACHE_TTL_S=900
REC_TAG_WEIGHT=0.55
REC_VISUAL_WEIGHT=0.45
REC_STRICTNESS=0.55
REC_CANDIDATE_LIMIT=400
REC_TAG_FLOOR_SCORE=0.08

# -------- Worker tuning --------
WORKER_SEED=1337
WORKER_LIMIT=0
WORKER_BATCH=32
WORKER_ONLY_MISSING=1
WORKER_DRY_RUN=0
WORKER_SLEEP=0
WORKER_NET_RETRY_ATTEMPTS=4
WORKER_NET_RETRY_BASE=1.0
WORKER_NET_RETRY_MAX=20.0
VL_IMAGE_MODE=file
VL_NORMALIZE_JPEG=1
VL_MEDIA_DIR=/app/runtime/media_vl
VL_FILE_URL_PREFIX=file:

# -------- EH incremental ingest --------
EH_BASE_URL=https://e-hentai.org
EH_API_URL=https://api.e-hentai.org/api.php
EH_USER_AGENT=AutoEhHunter/1.0
EH_COOKIE=
EH_STATE_FILE=/app/runtime/eh_incremental_state.json
EH_QUEUE_FILE=/app/runtime/eh_gallery_queue.txt
EH_INGEST_TIMEOUT=45
EH_API_BATCH_SIZE=25
EH_SIGLIP_MODEL=google/siglip-so400m-patch14-384
EH_SIGLIP_DEVICE=cpu
EH_TRANSLATION_URL=https://github.com/EhTagTranslation/Database/releases/latest/download/db.text.json
EH_TRANSLATION_CACHE=/app/runtime/db.text.js
EH_TRANSLATION_MAX_AGE_HOURS=24
EH_FORCE_REFRESH_TRANSLATION=0
EH_INIT_SCHEMA=0
EH_DRY_RUN=0
EH_FILTER_CATEGORY= #'western' 'non-h' or leave empty for no filter
EH_MIN_RATING= #0.0-5.0, or leave empty for no filter
EH_FILTER_TAG= 

LOG_LEVEL=INFO
