services:
  compute:
    image: autoeh-compute:local
    build:
      context: .
      dockerfile: compute/Dockerfile
    container_name: autoeh-compute
    env_file:
      - compute/.env
    command: ["agent"]
    ports:
      - "18080:18080"
    volumes:
      - ./compute/runtime:/app/runtime
      - ./compute/hf_cache:/root/.cache/huggingface
      - ./compute/eh_ingest_cache:/app/runtime/eh_ingest_cache
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://127.0.0.1:18080/health"]
      interval: 30s
      timeout: 8s
      retries: 5
      start_period: 20s

    # Uncomment if this node has NVIDIA runtime and you need GPU for SigLIP.
    # gpus: all
